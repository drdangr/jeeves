# Ingest: модуль загрузки и подготовки знаний

## Назначение

Модуль `Ingest` отвечает за загрузку, обработку и структурирование исходного контента (в основном — Markdown-документов), чтобы превратить его в пригодную для поиска и анализа базу знаний. Он является входной точкой всей системы RAG и формирует основу для работы Искателя и Аналитика.

---

## Задачи модуля

- Загрузка файлов из указанной директории (например, `content/`)
    
- Чанкирование (разбиение текста на смысловые блоки)
    
- Извлечение тегов и метаинформации
    
- Генерация эмбеддингов для каждого чанка
    
- Индексация чанков в векторной базе (например, Chroma, FAISS)
    
- Обновление индексов при изменении исходных файлов
    

---

## Этапы обработки

### 1. Загрузка и обход файловой структуры

- Сканирование выполняется каждый раз при запуске `ingest(path)` или при вызове `update_if_changed(path)`
    
- Поддержка форматов: Markdown (.md), опционально — .txt, .docx
    
- Рекурсивный обход поддиректорий
    
- Сопоставление файлов с логикой структуры мира (темы, персонажи, главы)
    

### 2. Чанкирование

- Используется инструмент `RecursiveCharacterTextSplitter` из библиотеки `LangChain`, настроенный для работы с Markdown-документами.
    
- Позволяет сохранять структуру заголовков, специальных элементов и ссылок формата `[[...]]`.
    
- Гибкая настройка разделителей и размеров чанков.
    
- Поддерживает локальную работу и легко интегрируется с остальными компонентами RAG-системы.
    
- При необходимости — возможно использование специализированного токенизатора для русского языка через `transformers` или `spaCy`.
    
- При отсутствии ярко выраженной структуры fallback на абзацы.
    
- Привязка чанков к исходному файлу и позиции внутри него — каждый чанк хранит информацию о том, из какого файла он извлечён и в каком месте оригинального текста он расположен (например, диапазон абзацев или токенов). Это необходимо для отображения исходного контекста, поддержки визуальной навигации и точного обновления при изменениях.- Семантический анализ определяет границы чанков по смысловой близости между фрагментами, позволяя определить, сколько абзацев должен включать каждый чанк
    
- При отсутствии ярко выраженной структуры — fallback на абзацы
    
- Резервные стратегии: разбиение по заголовкам, пользовательским маркерам
    
- Гибкая настройка размера чанков (по токенам или символам)
    
- Привязка чанков к исходному файлу и позиции внутри него — каждый чанк хранит информацию о том, из какого файла он извлечён, и в каком месте оригинального текста он расположен (например, диапазон абзацев или токенов). Это необходимо для отображения исходного контекста, поддержки визуальной навигации и точного обновления при изменениях
    

### 3. Извлечение тегов и метаданных

- Распознавание тегов `#тег` внутри Markdown и привязка к чанкам
    
- Извлечение ссылок `[[...]]` как индикаторов связей между сущностями и документами
    
- Анализ заголовков (`#`, `##`) для выделения тематики и иерархии
    
- Работа с временными метками:
    
    - Явное извлечение дат (например, `2047`, `1 января 2091`)
        
    - В перспективе — распознавание относительных форм ("через три года", "после катастрофы")
        
    - Сохранение в метаданных для временной шкалы и аналитики
        
- Попытка категоризации по содержанию (темы, персонажи, локации и т.п.) — для дерева знаний и фильтрации
    

### 4. Генерация эмбеддингов

- Модель: `ai-forever/sbert_large_mt_nlu_ru`
    
- Библиотека: `sentence-transformers`
    
- Возможность работы локально (с GPU)
    

### 5. Индексация и хранение

- Сохраняются: текст чанка, эмбеддинг, источник, метаинформация, ссылки
    
- Векторные хранилища: FAISS, ChromaDB, AnnLite (опционально)
    
- Использование хэша или UUID для отслеживания уникальности и изменений
    

---

## Интерфейс взаимодействия

- `ingest(path: str) -> List[Chunk]` — полный процесс обработки
    
- `update_if_changed(path: str)` — выборочная переиндексация при изменениях
    

---

## Используется в:

- [[docs/architecture/seeker|Seeker]] — для поиска по базе знаний
    
- [[docs/architecture/analyst|Analyst]] — для получения полнотекстового контекста
    
- [[docs/architecture/interface|Interface]] — для отображения актуального документа и его связей