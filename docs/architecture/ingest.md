# Ingest: модуль загрузки и подготовки знаний

## Назначение

Модуль `Ingest` отвечает за загрузку, обработку и структурирование исходного контента (в основном — Markdown-документов), чтобы превратить его в пригодную для поиска и анализа базу знаний. Он является входной точкой всей системы RAG и формирует основу для работы Искателя, Аналитика и Ученика.

---

## Задачи модуля

- Загрузка файлов из указанной директории (например, `content/`)
    
- Чанкирование (разбиение текста на смысловые блоки)
    
- Извлечение тегов, ссылок, метаинформации и терминов
    
- Формирование Тематического графа
    
- Формирование Словаря терминов
    
- Индексация чанков в векторной базе (например, Chroma + FAISS)
    
- Генерация эмбеддингов для каждого чанка
    
- Обновление векторной базы при изменении исходных файлов
    

---

## Этапы обработки

### 1. Загрузка и обход файловой структуры

- Сканирование выполняется при запуске `ingest(path)` или `update_if_changed(path)`
    
- Поддерживаются форматы: `.md` (основной), опционально `.txt`, `.docx`
    
- Рекурсивный обход поддиректорий
    

### 2. Построение Тематического графа

- До этапа чанкирования создается иерархическая структура Тем — Тематический граф.
    
- Вершины графа: Темы (области знаний).
    
- Связи между темами: взвешенные, на основе явных связей и совместных упоминаний.
    
- После привязки чанков веса связей уточняются в зависимости от распределения чанков между темами.
    
- Тематический граф будет активно использоваться всеми субличностями Дживса (Искатель, Аналитик, Ученик) и в интерфейсе визуализации графов.
    
- Подробнее о структуре Тематического графа см. [[docs/architecture/thematic-graph|документ описания тематического графа]].
    

### 3. Чанкирование

- Используется инструмент `RecursiveCharacterTextSplitter`, адаптированный для Markdown-документов.
    
- Учитываются заголовки, специальные элементы и ссылки `[[...]]`.
    
- Гибкая настройка длины чанков.
    
- Семантический анализ для логических границ.
    
- Каждый чанк сохраняет:
    
    - ссылку на исходный файл,
        
    - позицию,
        
    - ассоциации с темами Тематического графа.
        
- Подробнее см. [[docs/architecture/ingest-chunking|документ описания чанкирования]].
    

### 4. Извлечение тегов, ссылок, терминов и метаданных

- Распознавание тегов `#тег`.
    
- Извлечение внутренних ссылок `[[...]]`.
    
- Извлечение потенциальных терминов для формирования Словаря терминов.
    
- Термины классифицируются на описанные (на основе внутренних ссылок выявлен досвященный этому термину документ) и неописанные.
    
- Блок тегов корректно обрабатывается.
    
- Заголовки фиксируются как признаки тематической структуры.
    
- Работа с датами и событиями.
    

### 5. Генерация эмбеддингов

- Модель: `ai-forever/sbert_large_mt_nlu_ru`
    
- Библиотека: `sentence-transformers`
    
- Локальная работа с поддержкой GPU.
    
- Эмбеддинги сохраняются с привязкой к темам.
    

### 6. Индексация и хранение

- Используется `ChromaDB` + `FAISS`.
    
- Для каждого чанка сохраняются:
    
    - текст,
        
    - эмбеддинг,
        
    - источник (файл),
        
    - позиция в документе,
        
    - ассоциации с Темами Тематического графа,
        
    - теги и ссылки,
        
    - дата изменения.
        

### 7. Формирование и обновление Словаря терминов

- Все термины собираются в отдельную структуру.
    
- Термины классифицируются:
    
    - Описанные (ссылки на статьи);
        
    - Неописанные (важная область для развития базы).
        
- Словарь терминов будет использоваться в модулях Искателя, Аналитика и особенно Ученика для выявления пробелов в знаниях.
    
- Подробнее см. [[docs/architecture/terms-dictionary|документ описания работы со Словарём терминов]].
    

---

## Обновление и синхронизация

### Отслеживание изменений

- Хеши файлов и даты модификаций.
    

### Триггеры обновления

- Кнопка интерфейса
    
- Автообновление при старте
    
- Обращение от Ученика при правках
    

### Алгоритм обновления

- Выявление изменений
    
- Перечанкирование, регенерация эмбеддингов
    
- Обновление Тематического графа
    
- Обновление Словаря терминов
    
- Обновление локальной базы
    

---

## Интерфейс взаимодействия

```python
ingest(path: str) -> List[Chunk]       # Полная инициализация базы
update_if_changed(path: str)           # Обновление при изменениях
build_thematic_graph(path: str)        # Построение тематического графа
update_terms_dictionary(path: str)     # Обновление словаря терминов
```

---

## Используется в

- [[docs/architecture/seeker|Seeker]] — поиск и фильтрация знаний с опорой на темы
    
- [[docs/architecture/analyst|Analyst]] — аналитика на основе тематических связей
    
- [[docs/architecture/learner|Learner]] — работа с неописанными терминами
    
- [[docs/architecture/interface|Interface]] — отображение Тематического графа и связей