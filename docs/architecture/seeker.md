# Искатель

## Назначение

Искатель (Seeker) — модуль Дживса, отвечающий за нахождение релевантных фрагментов знаний из контента, доступного ассистенту. Он представляет собой первую и обязательную фазу в архитектуре RAG (retrieval-augmented generation).

## Задачи

- Поиск по эмбеддингам с использованием векторной базы
- Приоритизация и фильтрация найденных результатов по контексту запроса
- Формирование набора данных для передачи в модуль [[docs/architecture/analyst|"Аналитик"]]
- Обработка пользовательских запросов и преобразование их в векторный формат

## Основные принципы работы

1. **Чанкирование**: выполняется в модуле [[docs/architecture/ingest|`ingest`]]. Контент предварительно разбивается на смысловые единицы (чанки).

2. **Генерация эмбеддингов**: производится в модуле [[docs/architecture/ingest|`ingest`]]. Каждое смысловое ядро преобразуется в векторное представление с помощью выбранной модели.

3. **Поиск**: при поступлении пользовательского запроса, он также преобразуется в эмбеддинг, после чего происходит сравнение по косинусному расстоянию с существующими векторами.

4. **Ранжирование и фильтрация**: найденные фрагменты сортируются по степени релевантности, затем отбираются топ-N. В процессе учитываются:
   - эмбеддинговое расстояние,
   - соответствие ключевым словам в оригинальном тексте,
   - теговая релевантность (теги, расставленные в `.md`-файлах, имеют приоритет, если совпадают с запросом).

5. **Передача в аналитик**: лучшие фрагменты передаются в модуль [[docs/architecture/analyst|"Аналитик"]] для осмысленной интерпретации и генерации ответа.

## Особенности реализации

- Поиск может осуществляться как по всей базе, так и по ограниченной подсекции (по тегу, источнику, времени и т.д.)
- Поддержка нескольких источников эмбеддингов (по умолчанию используется `ai-forever/sbert_large_mt_nlu_ru`, также возможны OpenAI и SentenceTransformers при особых настройках)
- Отслеживание точности с последующим уточнением (в связке с [[docs/architecture/learner|"Ученик"]])

## Зависимости

- Модель генерации эмбеддингов: `ai-forever/sbert_large_mt_nlu_ru` — оптимальна для работы с русскоязычным контентом, запускается локально через `sentence-transformers`
- `sentence-transformers`, `numpy`, `scikit-learn`, `faiss` или `chromadb` — библиотеки для генерации и хранения векторов
- Модуль [[docs/architecture/ingest|`ingest`]] — поставляет актуальные эмбеддинги и метаинформацию
- Конфигурационный файл `.env` — содержит параметры генерации, пути к индексам и лимиты поиска

## Интерфейс взаимодействия

Метод `find_relevant_chunks(query: str) -> List[Chunk]`

## Перспективы

- Интеграция семантических фильтров (по темам, персонажам, локациям)
- Мультимодальный поиск (в т.ч. по изображениям, если появятся визуальные данные)
- Подключение лексико-семантических подсказок и обогащения контекста
- Интеграция с модулем [[docs/architecture/learner|"Ученик"]] для уточнения неоднозначных запросов
